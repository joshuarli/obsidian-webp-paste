var{defineProperty:Q,getOwnPropertyNames:G,getOwnPropertyDescriptor:I}=Object,L=Object.prototype.hasOwnProperty;var X=new WeakMap,U=(j)=>{var q=X.get(j),z;if(q)return q;if(q=Q({},"__esModule",{value:!0}),j&&typeof j==="object"||typeof j==="function")G(j).map((C)=>!L.call(q,C)&&Q(q,C,{get:()=>j[C],enumerable:!(z=I(j,C))||z.enumerable}));return X.set(j,q),q};var W=(j,q)=>{for(var z in q)Q(j,z,{get:q[z],enumerable:!0,configurable:!0,set:(C)=>q[z]=()=>C})};var _={};W(_,{default:()=>R});module.exports=U(_);var K=require("obsidian"),Y={quality:85};class R extends K.Plugin{settings=Y;async onload(){await this.loadSettings(),this.addSettingTab(new Z(this.app,this)),this.registerEvent(this.app.workspace.on("editor-paste",(j,q,z)=>{if(!j.clipboardData)return;let C=j.clipboardData.files;if(C.length===0)return;let H=C[0];if(!H.type.startsWith("image/"))return;if(H.type==="image/webp")return;j.preventDefault(),this.convertAndSave(H,q,z)}))}async convertAndSave(j,q,z){let C=await createImageBitmap(j),H=new OffscreenCanvas(C.width,C.height);H.getContext("2d").drawImage(C,0,0),C.close();let $=await(await H.convertToBlob({type:"image/webp",quality:this.settings.quality/100})).arrayBuffer(),J=new Date,y=`Pasted image ${J.getFullYear().toString()+String(J.getMonth()+1).padStart(2,"0")+String(J.getDate()).padStart(2,"0")+String(J.getHours()).padStart(2,"0")+String(J.getMinutes()).padStart(2,"0")+String(J.getSeconds()).padStart(2,"0")}`,O=z.file;if(!O)return;let B=await this.getAttachmentPath(y,"webp",O),k=await this.app.vault.createBinary(B,$),D=this.app.fileManager.generateMarkdownLink(k,O.path);q.replaceSelection(D)}async getAttachmentPath(j,q,z){let C=this.app.vault.getAvailablePath?void 0:void 0,H=this.app;if(H.vault.getAvailablePathForAttachments)return await H.vault.getAvailablePathForAttachments(j,q,z);let M=z.parent?.path??"",V=M?`${M}/${j}`:j;return this.app.vault.getAvailablePath(V,q)}async loadSettings(){this.settings=Object.assign({},Y,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}}class Z extends K.PluginSettingTab{plugin;constructor(j,q){super(j,q);this.plugin=q}display(){let{containerEl:j}=this;j.empty(),new K.Setting(j).setName("Image quality").setDesc("WebP compression quality (1â€“100). Lower values = smaller files.").addSlider((q)=>q.setLimits(1,100,1).setValue(this.plugin.settings.quality).setDynamicTooltip().onChange(async(z)=>{this.plugin.settings.quality=z,await this.plugin.saveSettings()}))}}
